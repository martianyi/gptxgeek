{{ partial "header.html" . }} {{ partial "content_header.html" . }} {{ if
$.Site.Params.nightMode }}
<body class="page-body boxed-container io-black-mode">
  {{ else }}
  <body class="page-body boxed-container io-grey-mode">
    {{ end }}
    <main role="main" class="flex-shrink-0">
      <div class="container">
        <div class="news-container">
          <!-- 头部banner -->
          <div class="news-header" style="background-color: #4169e1">
            <!-- <div class="news-icon">
              <img src="/images/news-icon.svg" alt="News Icon" />
            </div> -->
            <div class="header-text">
              <h1>AI快讯：每日热点、融资与产品动态</h1>
              <div class="subtitle">
                每日AI热点速递，融资动态与产品更新全掌握！
              </div>
            </div>
          </div>

          <div class="search-wrapper">

            <!-- 搜索框 -->
            <div class="search-box">
              <input type="text" placeholder="输入关键词搜索定位(精确匹配)" />
            </div>
          </div>

          <!-- 新闻列表 -->
          <div class="timeline-container">
            {{ range (.Pages.GroupByDate "2006-01").Reverse }} {{ $monthYear :=
            .Key }} {{ range (.Pages.GroupByDate "2006-01-02").Reverse }} {{
            $firstPage := index .Pages 0 }}
            <!-- 日期块 -->
            <div class="date-marker">
              <div class="date-square"></div>
              <div class="date-text">
                {{ $firstPage.Date.Format "1月2日" }}· {{- $weekday :=
                $firstPage.Date.Format "Monday" -}} {{- $weekdayCN := dict
                "Monday" "周一" "Tuesday" "周二" "Wednesday" "周三" "Thursday"
                "周四" "Friday" "周五" "Saturday" "周六" "Sunday" "周日" -}} {{-
                index $weekdayCN $weekday -}}
              </div>
            </div>

            <!-- 文章列表 -->
            {{ range .Pages }}
            <div class="article-item">
              <div class="dot-marker"></div>
              <article class="article-content">
                <h2 class="article-title">
                  <a href="{{ .Permalink }}">{{ .Title }}</a>
                </h2>
                <div class="article-summary">{{ .Summary }}</div>
                {{ with .Params.source }}
                <div class="article-source">来源：{{ . }}</div>
                {{ end }}
              </article>
            </div>
            {{ end }} {{ end }} {{ end }}
          </div>
        </div>
      </div>
    </main>

    <style>
      .content {
        font-size: 16px;
      }
      .content a {
        color: #007bff;
      }
      .content a:hover {
        color: #f1404b;
      }
      .content h1,
      .content h2,
      .content h3,
      .content h4 {
        margin: 15px 15px 15px 0px;
      }
      .content p {
        line-height: 1.5;
        margin: 15px 0;
      }
      .big-header-banner .page-header {
        background: gray;
      }
      .main-content {
        margin-left: 0px;
      }
      .page-header {
        left: 0px;
      }
      img {
        max-width: 100%;
      }
      .news-container {
        position: relative;
        padding: 20px;
      }

      .news-header {
        display: flex;
        align-items: center;
        padding: 20px;
        border-radius: 10px;
        color: white;
        margin-bottom: 20px;
      }

      .news-item {
        margin-bottom: 30px;
        border-left: 2px solid #4169e1;
        padding-left: 20px;
      }
      /* 调整时间线容器的内边距 */
      .timeline-container {
        padding: 20px 0 20px 40px; /* 修改左内边距，移除右内边距 */
        position: relative;
        margin-left: 20px; /* 添加左外边距 */
      }

      /* 调整时间轴线的位置 */
      .timeline-container::before {
        content: "";
        position: absolute;
        left: 6px; /* 修改左定位，使线条对齐方块 */
        top: 0;
        bottom: 0;
        width: 1px;
        background-color: rgba(217, 217, 217, 0.5);
      }

      /* 调整日期标记的样式 */
      .date-marker {
        display: flex;
        align-items: center;
        border-radius: 25px;
        margin: 30px 0 20px -40px; /* 修改左边距，使日期标记对齐 */
        position: relative;
      }

      .date-square {
        width: 12px;
        height: 12px;
        background-color: #4660ff;
        margin-right: 15px;
        position: relative;
        z-index: 1; /* 确保方块在线之上 */
      }

      /* 调整文章项的位置 */
      .article-item {
        position: relative;
        margin: 20px 0 20px 0; /* 修改左边距 */
        padding-left: 20px; /* 添加左内边距 */
      }

      :root {
        --pulseSize: 8px;
        --blue: rgba(95, 139, 250, 0.65);
        --transparentBlue: rgba(95, 139, 250, 0);
      }

      /* 调整圆点标记的位置 */
      .dot-marker {
        position: absolute;
        left: -38px; /* 调整圆点位置 */
        top: 14px;
        width: var(--pulseSize);
        height: var(--pulseSize);
        border-radius: 50%;
        background-color: var(--blue);
        box-shadow: 0 0 0 var(--blue);
        animation: pulsing 2s infinite;
        transition: all 0.2s;
        z-index: 1; /* 确保圆点在线之上 */
      }

      .dot-marker:hover {
        --blue: rgba(209, 167, 160, 0.65);
        --transparentBlue: rgba(209, 167, 160, 0);
      }

      .dot-marker:active {
        transform: scale(1.5);
      }

      @keyframes pulsing {
        from {
          box-shadow: 0 0 0 0 var(--blue);
        }
        70% {
          box-shadow: 0 0 0 var(--pulseSize) var(--transparentBlue);
        }
        to {
          box-shadow: 0 0 0 0 var(--transparentBlue);
        }
      }

      /* 文章内容 */
      .article-content {
        background: transparent;
        padding: 0;
      }

      .article-title {
        margin: 0 0 12px 0;
      }

      .article-title a {
        color: #333;
        text-decoration: none;
        font-size: 16px;
        font-weight: 500;
        line-height: 1.5;
      }

      .article-summary {
        color: #666;
        font-size: 14px;
        line-height: 1.6;
        margin-bottom: 10px;
      }

      .article-source {
        color: #999;
        font-size: 14px;
        margin-top: 8px;
      }

      /* 链接样式 */
      .article-summary a {
        color: #4660ff;
        text-decoration: none;
      }

      /* 添加一个包装容器用于 sticky 定位 */
      .search-wrapper {
        position: sticky;
        top: 0;
        z-index: 1000;
        background: transparent; /* 或者与你的页面背景色匹配 */
        padding: 10px 0;
        margin: -10px 0; /* 抵消padding造成的间距 */
        /* 可选：添加底部阴影效果 */
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        transition: box-shadow 0.3s ease;
      }

      /* 滚动时添加更明显的阴影 */
      .search-wrapper.scrolled {
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      }

      .search-box {
        position: relative;
        margin: 20px 0;
        /* 如果需要左右留白，可以加上 */
        padding: 0 20px;
      }

      /* 调整搜索结果的定位，使其相对于 search-wrapper */
      .search-results {
        position: absolute;
        top: 100%;
        left: 20px; /* 与 search-box 的 padding 对应 */
        right: 20px;
        margin-top: 5px;
        background: white;
        border: 1px solid #eee;
        border-radius: 5px;
        max-height: 300px;
        overflow-y: auto;
        z-index: 1000;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        display: none;
      }


      .search-box input {
        width: 100%;
        padding: 10px;
        border: 1px solid #eee;
        border-radius: 5px;
        background-color: #f5f5f5;
      }


      .search-result-item {
        padding: 10px;
        cursor: pointer;
        border-bottom: 1px solid #eee;
      }

      .search-result-item:hover {
        background-color: #f5f5f5;
      }

      .result-title {
        font-weight: 500;
        margin-bottom: 4px;
      }

      .result-preview {
        font-size: 13px;
        color: #666;
        line-height: 1.4;
      }

      .no-results {
        padding: 10px;
        color: #666;
        text-align: center;
      }

      /* 关键字高亮样式 */
      .highlight-text {
        background-color: transparent;
        color: #4660ff;
        font-weight: bold;
      }

      /* 响应式适配 */
      @media (max-width: 768px) {
        .timeline-container {
          padding-left: 30px; /* 移动端减少左内边距 */
          margin-left: 10px; /* 移动端减少左外边距 */
        }

        .date-marker {
          margin-left: -30px; /* 移动端调整日期标记位置 */
        }

        .dot-marker {
          left: -28px; /* 移动端调整圆点位置 */
        }
      }

      /* 如果你的网站有顶部导航栏，需要调整 top 值 */
      @media (min-width: 769px) {
        .search-wrapper {
          top: 60px; /* 根据你的导航栏高度调整 */
        }
      }

      /* 移动端适配 */
      @media (max-width: 768px) {
        .search-wrapper {
          top: 0;
          padding: 10px;
          margin: -10px -20px; /* 使搜索框延伸到边缘 */
        }

        .search-box {
          padding: 0;
          margin: 10px 0;
        }

        .search-results {
          left: 0;
          right: 0;
        }
      }
    </style>

    {{ partial "content_footer.html" . }} {{ partial "footer.html" . }}

    <script>
      $(document).ready(function () {
        $(".search-box").append('<div class="search-results"></div>');

        let searchTimeout;
        let lastSearchText = "";

        // 高亮文本的函数
        function highlightText(text, searchText) {
          if (!searchText) return text;
          const regex = new RegExp(`(${searchText})`, "gi");
          return text.replace(regex, '<span class="highlight-text">$1</span>');
        }

        // 移除高亮
        function removeHighlight() {
          $(".article-title a, .article-summary").each(function () {
            const $this = $(this);
            $this.html($this.text());
          });
        }

        $(".search-box input").on("input", function () {
          clearTimeout(searchTimeout);
          const searchText = $(this).val().trim();

          // 清除之前的搜索结果和高亮
          $(".search-results").empty();
          removeHighlight();

          if (searchText === "") {
            $(".search-results").hide();
            lastSearchText = "";
            return;
          }

          searchTimeout = setTimeout(function () {
            let results = [];
            lastSearchText = searchText;

            // 搜索标题和摘要
            $(".article-item").each(function () {
              const $item = $(this);
              const $title = $item.find(".article-title a");
              const $summary = $item.find(".article-summary");

              const titleText = $title.text();
              const summaryText = $summary.text();

              const titleMatch = titleText
                .toLowerCase()
                .includes(searchText.toLowerCase());
              const summaryMatch = summaryText
                .toLowerCase()
                .includes(searchText.toLowerCase());

              if (titleMatch || summaryMatch) {
                // 高亮匹配的文本
                if (titleMatch) {
                  $title.html(highlightText(titleText, searchText));
                }
                if (summaryMatch) {
                  $summary.html(highlightText(summaryText, searchText));
                }

                // 为搜索结果准备预览文本
                let previewText = "";
                if (titleMatch) {
                  previewText = titleText;
                } else {
                  // 从摘要中提取匹配关键词周围的文本
                  const matchIndex = summaryText
                    .toLowerCase()
                    .indexOf(searchText.toLowerCase());
                  const startIndex = Math.max(0, matchIndex - 20);
                  const endIndex = Math.min(
                    summaryText.length,
                    matchIndex + searchText.length + 20,
                  );
                  previewText =
                    (startIndex > 0 ? "..." : "") +
                    summaryText.substring(startIndex, endIndex) +
                    (endIndex < summaryText.length ? "..." : "");
                }

                results.push({
                  title: titleText,
                  preview: previewText,
                  element: $item,
                  isTitle: titleMatch,
                });
              }
            });

            // 显示搜索结果
            if (results.length > 0) {
              const $results = $(".search-results");
              $results.empty().show();

              results.forEach(function (result) {
                const $resultItem = $('<div class="search-result-item">');

                // 创建结果项的内容
                const $resultTitle = $('<div class="result-title">').html(
                  highlightText(result.title, searchText),
                );

                const $resultPreview = $('<div class="result-preview">').html(
                  highlightText(result.preview, searchText),
                );

                $resultItem
                  .append($resultTitle)
                  .append(result.isTitle ? "" : $resultPreview)
                  .on("click", function () {
                    // 滚动到目标位置
                    $("html, body").animate(
                      {
                        scrollTop: result.element.offset().top - 100,
                      },
                      500,
                    );

                    // 隐藏搜索结果
                    $results.hide();
                  });

                $results.append($resultItem);
              });
            } else {
              $(".search-results")
                .html('<div class="no-results">未找到匹配的结果</div>')
                .show();
            }
          }, 300);
        });

        // 点击页面其他地方时隐藏搜索结果，但保持高亮
        $(document).on("click", function (e) {
          if (!$(e.target).closest(".search-box").length) {
            $(".search-results").hide();
          }
        });

        // 当搜索框失去焦点且为空时，移除所有高亮
        $(".search-box input").on("blur", function () {
          if ($(this).val().trim() === "") {
            removeHighlight();
          }
        });
      });

      // 添加到现有的 JavaScript 代码中
      $(window).on('scroll', function() {
        const $searchWrapper = $('.search-wrapper');
        if ($(window).scrollTop() > 100) { // 可以调整这个值
            $searchWrapper.addClass('scrolled');
        } else {
            $searchWrapper.removeClass('scrolled');
        }
      });

    </script>
  </body>
</body>
